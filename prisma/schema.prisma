generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int             @id @default(autoincrement())
  username      String          @unique
  password_hash String
  nama          String
  role          UserRole
  prodi_id      Int?
  dosenPengampu DosenPengampu[]
  programStudi  ProgramStudi?   @relation("UserToProgramStudi", fields: [prodi_id], references: [id])
  pesertaKelas  PesertaKelas[]  @relation("PesertaKelasToUser")
  programStudis ProgramStudi[]  @relation("UserToProgramStudis")

  @@map("users")
}

model ProgramStudi {
  id           Int         @id @default(autoincrement())
  kode_prodi   String      @unique
  jenjang      Jenjang
  nama         String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  kurikulum    Kurikulum[]
  users        User[]      @relation("UserToProgramStudi")
  userPrograms User[]      @relation("UserToProgramStudis")

  @@map("program_studi")
}

model Kurikulum {
  id            Int             @id @default(autoincrement())
  nama          String
  tahun         Int
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  prodi_id      Int?
  AssasmentArea AssasmentArea[]
  cpl           CPL[]
  programStudi  ProgramStudi?   @relation(fields: [prodi_id], references: [id])
  mataKuliah    MataKuliah[]

  @@map("kurikulum")
}

model MataKuliah {
  id           Int       @id @default(autoincrement())
  kode_mk      String    @unique
  nama         String
  sks          Int
  kurikulum_id Int
  semester     Int
  sifat        String
  kelas        Kelas[]
  kurikulum    Kurikulum @relation(fields: [kurikulum_id], references: [id])
  rps          RPS[]
  cpl          CPL[]     @relation("CPLToMataKuliah")

  @@map("mata_kuliah")
}

model CPL {
  id           Int          @id @default(autoincrement())
  kode_cpl     String
  deskripsi    String
  kurikulum_id Int
  kurikulum    Kurikulum    @relation(fields: [kurikulum_id], references: [id])
  iks          Ik[]
  mataKuliah   MataKuliah[] @relation("CPLToMataKuliah")

  @@map("cpl")
}

model AssasmentArea {
  id           Int       @id @default(autoincrement())
  nama         String
  kurikulum_id Int
  kurikulum    Kurikulum @relation(fields: [kurikulum_id], references: [id])

  @@map("assasment_area")
}

model TahunAjaran {
  id          Int      @id @default(autoincrement())
  tahun       String
  semester    Semester
  kode_neosia String   @unique
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  kelas       Kelas[]

  @@unique([tahun, semester])
  @@map("tahun_ajaran")
}

model Kelas {
  id              Int             @id @default(autoincrement())
  nama_kelas      String
  tahun_ajaran_id Int
  neosia_id       String?         @unique
  sks             Int             @default(0)
  kode_mk         String
  nama_mk         String
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  matakuliah_id   Int?
  dosen_pengampu  DosenPengampu[]
  matakuliah      MataKuliah?     @relation(fields: [matakuliah_id], references: [id])
  tahun_ajaran    TahunAjaran     @relation(fields: [tahun_ajaran_id], references: [id])
  komponenNilai   KomponenNilai[]
  peserta_kelas   PesertaKelas[]
  cpmk            CPMK[]          @relation("CPMKToKelas")

  @@index([tahun_ajaran_id])
  @@index([kode_mk])
  @@map("kelas")
}

model DosenPengampu {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  kelas_id  Int
  dosen_id  Int
  dosen     User     @relation(fields: [dosen_id], references: [id])
  kelas     Kelas    @relation(fields: [kelas_id], references: [id])

  @@unique([kelas_id, dosen_id])
  @@map("dosen_pengampu")
}

model RPS {
  id                  Int            @id @default(autoincrement())
  file_path           String?
  is_locked           Boolean        @default(false)
  createdAt           DateTime       @default(now())
  deskripsi           String?
  materi_pembelajaran String?
  pustaka_pendukung   String?
  pustaka_utama       String?
  updatedAt           DateTime       @updatedAt
  matakuliah_id       Int
  nama_kaprodi        String?
  nama_koordinator    String?
  nama_penyusun       String?
  nomor_dokumen       String?
  tanggal_penyusunan  DateTime       @default(now())
  matakuliah          MataKuliah     @relation(fields: [matakuliah_id], references: [id])
  pertemuan           RPSPertemuan[]
  cpmk                CPMK[]         @relation("CPMKToRPS")
  ikas                Ik[]           @relation("IkaToRPS")

  @@map("rps")
}

model RPSPertemuan {
  id                  Int     @id @default(autoincrement())
  pekan_ke            Int
  kemampuan_akhir     String?
  bahan_kajian        String?
  metode_pembelajaran String?
  waktu               String?
  pengalaman_belajar  String?
  kriteria_penilaian  String?
  bobot_nilai         Float?
  rps_id              Int
  rps                 RPS     @relation(fields: [rps_id], references: [id], onDelete: Cascade)

  @@map("rps_pertemuan")
}

model CPMK {
  id                    Int                    @id @default(autoincrement())
  kode_cpmk             String
  is_locked             Boolean                @default(false)
  deskripsi             String
  kelas                 Kelas[]                @relation("CPMKToKelas")
  rps                   RPS[]                  @relation("CPMKToRPS")
  ik                    Ik[]                   @relation("IkaToCPMK")
  pemetaanKomponenCPMKs PemetaanKomponenCPMK[]

  @@map("cpmk")
}

model Ik {
  id        Int      @id @default(autoincrement())
  kode_ik   String   @unique
  deskripsi String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cpl_id    Int
  cpl       CPL      @relation(fields: [cpl_id], references: [id])
  cpmk      CPMK[]   @relation("IkaToCPMK")
  rps       RPS[]    @relation("IkaToRPS")

  @@map("ik")
}

model PesertaKelas {
  id          Int      @id @default(autoincrement())
  kelas_id    Int
  createdAt   DateTime @default(now())
  nilai_huruf String?
  nim         String
  nilai_angka Float?   @default(0)
  nama        String
  nilai       Nilai[]
  kelas       Kelas    @relation(fields: [kelas_id], references: [id])
  users       User[]   @relation("PesertaKelasToUser")

  @@unique([kelas_id, nim])
  @@map("peserta_kelas")
}

model KomponenNilai {
  id            Int                    @id @default(autoincrement())
  nama          String
  bobot         Float
  kelas_id      Int
  kelas         Kelas                  @relation(fields: [kelas_id], references: [id], onDelete: Cascade)
  nilai         Nilai[]                @relation("NilaiToKomponen")
  pemetaan_cpmk PemetaanKomponenCPMK[]

  @@map("komponen_nilai")
}

model Nilai {
  id                Int           @id @default(autoincrement())
  nilai_angka       Float
  peserta_kelas_id  Int
  komponen_nilai_id Int
  komponen          KomponenNilai @relation("NilaiToKomponen", fields: [komponen_nilai_id], references: [id], onDelete: Cascade)
  pesertaKelas      PesertaKelas  @relation(fields: [peserta_kelas_id], references: [id], onDelete: Cascade)

  @@unique([peserta_kelas_id, komponen_nilai_id])
  @@map("nilai")
}

model PemetaanKomponenCPMK {
  id Int @id @default(autoincrement())

  komponen_nilai_id Int
  komponen_nilai    KomponenNilai @relation(fields: [komponen_nilai_id], references: [id], onDelete: Cascade)

  cpmk_id Int
  cpmk    CPMK @relation(fields: [cpmk_id], references: [id], onDelete: Cascade)

  bobot Float

  @@map("pemetaan_komponen_cpmk")
}

enum UserRole {
  ADMIN
  DOSEN
  USER
}

enum Jenjang {
  S1
  S2
  S3
}

enum Semester {
  GANJIL
  GENAP
}
