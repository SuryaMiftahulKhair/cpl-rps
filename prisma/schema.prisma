generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  username      String         @unique
  password_hash String
  nama          String
  role          UserRole
  prodi_id      Int?
  programStudi  ProgramStudi?  @relation("UserToProgramStudi", fields: [prodi_id], references: [id])
  programStudis ProgramStudi[] @relation("UserToProgramStudis")

  @@map("users")
}

model ProgramStudi {
  id           Int         @id @default(autoincrement())
  kode_prodi   String      @unique
  jenjang      Jenjang
  nama         String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  kurikulum    Kurikulum[]
  users        User[]      @relation("UserToProgramStudi")
  userPrograms User[]      @relation("UserToProgramStudis")

  @@map("program_studi")
}

model Kurikulum {
  id            Int             @id @default(autoincrement())
  nama          String
  tahun         Int
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  prodi_id      Int?
  visi         String?
  misi         Json?

  AssasmentArea AssasmentArea[]
  cpl           CPL[]
  programStudi  ProgramStudi?   @relation(fields: [prodi_id], references: [id])
  mataKuliah    MataKuliah[]

  @@map("kurikulum")
}

model MataKuliah {
  id           Int       @id @default(autoincrement())
  kode_mk      String    @unique
  nama         String
  sks          Int
  kurikulum_id Int
  semester     Int
  sifat        String
  kelas        Kelas[]
  kurikulum    Kurikulum @relation(fields: [kurikulum_id], references: [id])
  rps          RPS[]
  cpl          CPL[]     @relation("CPLToMataKuliah")

  @@map("mata_kuliah")
}

model CPL {
  id           Int          @id @default(autoincrement())
  kode_cpl     String
  deskripsi    String
  kurikulum_id Int
  kurikulum    Kurikulum    @relation(fields: [kurikulum_id], references: [id])
  iks          Ik[]
  mataKuliah   MataKuliah[] @relation("CPLToMataKuliah")

  @@map("cpl")
}

model AssasmentArea {
  id           Int       @id @default(autoincrement())
  nama         String
  kurikulum_id Int
  kurikulum    Kurikulum @relation(fields: [kurikulum_id], references: [id])

  @@map("assasment_area")
}

model TahunAjaran {
  id         Int      @id @default(autoincrement())
  tahun      String
  semester   Semester
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  kelas      Kelas[]
  rps        RPS[]

  @@unique([tahun, semester])
  @@map("tahun_ajaran")
}

model Kelas {
  id              Int             @id @default(autoincrement())
  nama_kelas      String
  tahun_ajaran_id Int
  sks             Int             @default(0)
  kode_mk         String
  nama_mk         String
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  matakuliah_id   Int?
  rps_id          Int?
  matakuliah      MataKuliah?     @relation(fields: [matakuliah_id], references: [id])
  rps             RPS?            @relation(fields: [rps_id], references: [id])
  tahun_ajaran    TahunAjaran     @relation(fields: [tahun_ajaran_id], references: [id])
  komponenNilai   KomponenNilai[]
  peserta_kelas   PesertaKelas[]
  cpmk            CPMK[]          @relation("CPMKToKelas")

  @@index([tahun_ajaran_id])
  @@index([kode_mk])
  @@map("kelas")
}

model RPS {
  id                  Int            @id @default(autoincrement())
  file_path           String?
  is_locked           Boolean        @default(false)
  createdAt           DateTime       @default(now())
  deskripsi           String?
  materi_pembelajaran String?
  pustaka_pendukung   String?
  pustaka_utama       String?
  updatedAt           DateTime       @updatedAt
  matakuliah_id       Int
  nama_kaprodi        String?
  nama_koordinator    String?
  nama_penyusun       String?
  nomor_dokumen       String?
  tanggal_penyusunan  DateTime       @default(now())
  semester            Semester?
  tahun               String?
  tahun_ajaran_id     Int?
  kelas               Kelas[]
  matakuliah          MataKuliah     @relation(fields: [matakuliah_id], references: [id])
  tahun_ajaran        TahunAjaran?   @relation(fields: [tahun_ajaran_id], references: [id])
  pertemuan           RPSPertemuan[]
  cpmk                CPMK[]         @relation("CPMKToRPS")
  ikas                Ik[]           @relation("IkaToRPS")

  @@map("rps")
}

model RPSPertemuan {
  id                  Int      @id @default(autoincrement())
  pekan_ke            Int
  kemampuan_akhir     String?
  bahan_kajian        String?
  metode_pembelajaran String?
  waktu               String?
  pengalaman_belajar  String?
  kriteria_penilaian  String?
  bobot_cpmk          Float?
  rps_id              Int
  rps                 RPS      @relation(fields: [rps_id], references: [id], onDelete: Cascade)
  cpmk                CPMK[]   @relation("CPMKToPertemuan")
  

  @@map("rps_pertemuan")
}

model CPMK {
  id                     Int                    @id @default(autoincrement())
  kode_cpmk              String
  bobot_to_cpl           Float
  is_locked              Boolean                @default(true)
  deskripsi              String
  kelas                  Kelas[]                @relation("CPMKToKelas")
  rps_pertemuan          RPSPertemuan[]         @relation("CPMKToPertemuan")
  rps                    RPS[]                  @relation("CPMKToRPS")
  ik                     Ik[]                   @relation("IkaToCPMK")
  komponen_nilai          KomponenNilai[]

  @@map("cpmk")
}

model Ik {
  id        Int      @id @default(autoincrement())
  kode_ik   String   @unique
  deskripsi String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cpl_id    Int
  cpl       CPL      @relation(fields: [cpl_id], references: [id])
  cpmk      CPMK[]   @relation("IkaToCPMK")
  rps       RPS[]    @relation("IkaToRPS")

  @@map("ik")
}

model KomponenNilai {
  id                     Int                    @id @default(autoincrement())
  nama                   String
  bobot_nilai            Float
  kelas_id               Int
  cpmk_id                Int
  cpmk                   CPMK                   @relation(fields: [cpmk_id], references: [id], onDelete: Cascade)
  kelas                  Kelas                  @relation(fields: [kelas_id], references: [id], onDelete: Cascade)
  nilai                  Nilai[]

  @@map("komponen_nilai")
}

model Nilai {
  id                Int           @id @default(autoincrement())
  nilai_komponen    Float
  komponen_nilai_id Int
  komponen          KomponenNilai @relation(fields: [komponen_nilai_id], references: [id], onDelete: Cascade)
  peserta_kelas_id  Int
  peserta_kelas     PesertaKelas  @relation(fields: [peserta_kelas_id], references: [id], onDelete: Cascade)

  @@unique([peserta_kelas_id, komponen_nilai_id])
  @@map("nilai")
}

model Mahasiswa {
  id            Int            @id @default(autoincrement())
  nama          String
  nim           String         @unique
  created_at    DateTime       @default(now())
  peserta_kelas PesertaKelas[]

  @@map("mahasiswa")
}

model PesertaKelas {
  id                Int       @id @default(autoincrement())
  kelas_id          Int
  created_at        DateTime  @default(now())
  mahasiswa_id      Int
  nilai_akhir_angka Float?
  nilai_akhir_huruf String?
  nilai             Nilai[]
  kelas             Kelas     @relation(fields: [kelas_id], references: [id], onDelete: Cascade)
  mahasiswa         Mahasiswa @relation(fields: [mahasiswa_id], references: [id], onDelete: Cascade)

  @@unique([kelas_id, mahasiswa_id])
  @@map("peserta_kelas")
}

enum UserRole {
  ADMIN
  DOSEN
  USER
}

enum Jenjang {
  S1
  S2
  S3
}

enum Semester {
  GANJIL
  GENAP
}
